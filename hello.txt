Hello World !



# Importer le module ImportExcel
Import-Module ImportExcel

# Chemin vers le fichier Excel
$excelFilePath = "C:\chemin\vers\votre\fichier\s01_BillU (2).xlsx"

# Lire le fichier Excel
$excelData = Import-Excel -Path $excelFilePath

# URL de l'API REST de GLPI
$glpiApiUrl = "http://172.18.0.5/glpi/apirest.php"

# Clé API et identifiants
$apiKey = "votre-cle-api"  # Remplacez par votre clé API
$appToken = "votre-app-token"  # Remplacez par votre jeton d'application
$sessionToken = ""

# Obtenir un token de session
$response = Invoke-RestMethod -Uri "$glpiApiUrl/initSession" -Method Post -Headers @{
    "Content-Type" = "application/json"
    "App-Token" = $appToken
    "Authorization" = "user_token $apiKey"
} -Body '{}'

$sessionToken = $response.session_token

# Parcourir les lignes du fichier Excel
foreach ($row in $excelData) {
    $userId = $row.'ID Utilisateur'
    $entityId = $row.'ID Entité'

    # Ajouter l'utilisateur à une entité via l'API REST
    $body = @{
        input = @{
            users_id = $userId
            entities_id = $entityId
        }
    }

    $response = Invoke-RestMethod -Uri "$glpiApiUrl/UserEntity" -Method Post -Headers @{
        "Content-Type" = "application/json"
        "Session-Token" = $sessionToken
        "App-Token" = $appToken
    } -Body ($body | ConvertTo-Json)

    Write-Output "Utilisateur $userId ajouté à l'entité $entityId"
}

# Fermer la session
Invoke-RestMethod -Uri "$glpiApiUrl/killSession" -Method Post -Headers @{
    "Content-Type" = "application/json"
    "Session-Token" = $sessionToken
    "App-Token" = $appToken
} -Body '{}'














































Xavier
